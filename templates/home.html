{% extends 'base.html' %}

{% block content %}
<a href="{% url 'post_create' %}" class="nav-btn">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</a>
<div class="sort-container" style="margin-bottom:15px;">
    <select id="sort-selector">
        <option value="date-new">–ü–æ –¥–∞—Ç–µ (—Å–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ)</option>
        <option value="date-old">–ü–æ –¥–∞—Ç–µ (—Å–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ)</option>
        <option value="likes">–ü–æ –ª–∞–π–∫–∞–º</option>
        <option value="reposts">–ü–æ —Ä–µ–ø–æ—Å—Ç–∞–º</option>
        <option value="comments">–ü–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º</option>
    </select>
</div>
<div id="posts-container">
    {% for post in posts %}
        <div class="post" data-post-id="{{ post.id }}" id="post-item-{{ post.id }}">
            <div class="post open-post" data-post-id="{{ post.id }}" id="post-item-{{ post.id }}">
                {% if post.original_post %}
                    <!-- üîÅ –†–µ–ø–æ—Å—Ç -->
                    <p style="color:green;">
                        üîÅ {{ post.author.username }} —Å–¥–µ–ª–∞–ª —Ä–µ–ø–æ—Å—Ç
                    </p>

                    {% with orig=post.original_post %}
                        <div class="repost-box" style="border:1px solid #ccc; padding:10px; border-radius:10px;">
                            <p>
                                <img src="{{ orig.author.avatar.url }}" class="round" style="width:40px;height:40px;">
                            </p>
                            <h3>{{ orig.author.username }}</h3>
                            <p>{{ orig.content }}</p>
                            <small>{{ orig.created_at }}</small>

                            {% for img in orig.images.all %}
                                <img src="{{ img.image.url }}" style="max-width:200px; border-radius:10px; margin-top:10px;">
                            {% endfor %}
                        </div>
                    {% endwith %}

                {% else %}
                    <!-- –û–±—ã—á–Ω—ã–π –ø–æ—Å—Ç -->
                    <p><img src="{{ post.author.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="round"></p>
                    <h3>{{ post.author.username }}</h3>
                    <p>{{ post.content }}</p>
                    <small>{{ post.created_at }}</small>

                    {% for img in post.images.all %}
                        <img src="{{ img.image.url }}" style="max-width:200px; border-radius:10px; margin-top:10px;">
                    {% endfor %}
                {% endif %}
            </div>
        <!-- –õ–∞–π–∫–∏ -->
            {% if user.is_authenticated %}
                {% if post.is_liked %}
                    <button class="like-btn" data-post-id="{{ post.id }}">
                        <i class="fa-solid fa-heart" style="color:red;"></i>
                    </button>
                {% else %}
                    <button class="like-btn" data-post-id="{{ post.id }}">
                        <i class="fa-regular fa-heart"></i>
                    </button>
                {% endif %}
            {% endif %}
            <span id="like-actual-{{ post.id }}">{{ post.likes.count }}</span>
            <!-- –°—á–µ—Ç—á–∏–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
            <i class="fa-regular fa-comment"></i>
            <span id="comment-count">{{ post.comments.count }}</span>
            <!-- –†–µ–ø–æ—Å—Ç—ã -->
            {% if user.is_authenticated %}
                <button class="repost-btn" data-post-id="{{ post.id }}">
                    <i class="fa-solid fa-retweet"></i>
                </button>
            {% endif %}
            <span id="repost-count-{{ post.id }}">{{ post.reposts.count }}</span>

            {% if user.is_authenticated and user == post.author %}
                <button class="del-post-btn" data-post-id="{{ post.id }}">
                    <i class="fa-regular fa-trash-can"></i>
                </button>
            {% endif %}

            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
{#            <strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</strong>#}
{##}
{#            {% if user.is_authenticated %}#}
{#                <textarea id="comment-text-{{ post.id }}" rows="2"></textarea>#}
{#                <button class="comment-btn" data-post-id="{{ post.id }}">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>#}
{#            {% endif %}#}
{##}
{#            <div id="comment-list-{{ post.id }}">#}
{#                <ul id="comments-list-{{ post.id }}">#}
{#                    {% for comment in post.comments.all reversed %}#}
{#                        <li id="comment-{{ comment.id }}">#}
{#                            <strong>{{ comment.user.username }}</strong>:#}
{#                            <span class="comment-text">{{ comment.text }}</span>#}
{#                            <small class="text-muted"> {{ comment.created_at }} </small>#}
{##}
{#                            {% if user.is_authenticated %}#}
{#                                <button class="comment-like-btn" data-comment-id="{{ comment.id }}">#}
{#                                {% if comment.is_liked %}#}
{#                                    <i class="fa-solid fa-heart" style="color:red;"></i>#}
{#                                {% else %}#}
{#                                    <i class="fa-regular fa-heart"></i>#}
{#                                {% endif %}#}
{#                                </button>#}
{#                            {% endif %}#}
{##}
{#                            <span id="actual-comment-like-{{ comment.id }}">#}
{#                                {{ comment.comment_likes.count }}#}
{#                            </span>#}
{##}
{#                            {% if user.is_authenticated and user == comment.user %}#}
{#                                <button class="del-comment-btn" data-comment-id="{{ comment.id }}">–£–¥–∞–ª–∏—Ç—å</button>#}
{#                            {% endif %}#}
{#                        </li>#}
{#                    {% endfor %}#}

                </ul>
        </div>
    {% empty %}
        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤.</p>
    {% endfor %}
</div>
{% endblock %}
